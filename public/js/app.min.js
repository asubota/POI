/*! POI - v0.0.1 - 2014-06-24 */
var Poi=Backbone.Model.extend({defaults:function(){return{title:"New POI",description:null,lat:null,lng:null,visited:!1}}}),PoiList=Backbone.Collection.extend({model:Poi,url:"/api/pois",visited:function(){return this.where({visited:!0})}}),Pois=new PoiList,PoiView=Backbone.View.extend({template:_.template($("#poi-template").html()),className:"column",events:{"click .poi-edit":"showModal","click .poi-delete":"clear"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},showModal:function(){new Modal(this.model)},clear:function(){}}),Modal=Backbone.View.extend({template:_.template($("#modal-template").html()),initialize:function(a){this.model=a,this.render(this.model)},events:{"click .poi-save":"trySave"},trySave:function(){var a=["title","description","lat","lng"],b={};_.each(a,function(a){b[a]=this.$(".poi-"+a).val()},this),this.model.save(b),this.remove()},render:function(){this.$el.append(this.template(this.model.toJSON())),this.$(".poi-modal").modal("show")}}),AppView=Backbone.View.extend({el:$("#main"),events:{"click .show-poi-modal":"showModal"},initialize:function(){this.listenTo(Pois,"add",this.addOne),this.listenTo(Pois,"all",this.render),Pois.fetch()},showModal:function(){new Modal(new Poi)},addOne:function(a){var b=new PoiView({model:a});this.$(".poi-list").append(b.render().el)}});new AppView;var map=L.map("map").setView([51,31],10);L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png").addTo(map);